### 消息分发

 		RabbitMQ默认使用轮询分发消息的模式，当一个队列存在多个消费者时会将队列中的消息逐个分发给不同的消费者。这时候消息的处理速度就取决于消费者中处理速度最慢的那个。

`不公平分发`

意思就是如果这个任务我还没有处理完或者我还没有应答你，你先别分配给我，我目前只能处理一个 任务，然后 rabbitmq 就会把该任务分配给没有那么忙的那个空闲消费者，当然如果所有的消费者都没有完 成手上任务，队列还在不停的添加新任务，队列有可能就会遇到队列被撑满的情况，这个时候就只能添加 新的 worker 或者改变其他存储任务的策略



```java
//  void basicQos(int prefetchCount) throws IOException;
// prefetchCount表示不要同时给一个消费者推送多于1条消息，即一旦有1个消息还没有ack(确认)，则该消费者将block掉，直到有消息确认
channel.basicQos(1);
```



### 预取值

预取值是指消费者已接受但未确认的消息数量，所有已接受未确认的消息都会被缓存在消费者客户端中等待确认。所以需要一个限制来控制缓存中的消息上限。当缓存中消息达到上限后队列就不会在往这个消费者发送消息。这也是不公平分发的原理。

```java
// 预取值设置的越大，MQ吞吐量越好
// 预取值的设置应该考虑吞吐量和缓存占用情况两个因素
channel.basicQos(1);
```

