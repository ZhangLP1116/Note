> 简介
>
> ​		早期人们使用Internet来进行通信，当web出现后人们更多的使用Internet访问内容，紧接着流媒体的发展加剧了这一现象，如今Internet上大部分流量都是视频。
>
> ​		对于一个大型的内容服务提供方来说使用单一的服务器无法应对如此大量的请求，内容服务的特点是用户不在意提供内容的人，只在于所提供的内容是否需要，**这就使得一种解决方法的提出——内容分发网络（CDN，Content Distribution Network）**，内容提供商在世界各地建立数据中心，给这个区域进行内容分发，这是大牌球员的选择，小牌球员可以选择租用数据中心的机器进行内容分发服务。
>
> ​		另一种**去中心化的对等资源交换体系称为——对等网络（P2P）**，这一网络的特点是多个个体组成一个网络，网络中的个体之间进行资源的交换。
>
> ​		下面将先介绍Internet上内容分发面临的问题，在介绍如何建立强大的Web服务器，在介绍CND和P2P两个体系。

> 内容和Internet流量特点
>
> ​		**Internet内容的变化：**1994年大部分的流量是传统的FTP文件传输和电子邮件，然后Web流量将其远远抛在了后面，2000左右共享音乐、共享电影的P2P文件异军突起，到2003年网络上大部分是P2P流量，再后期使用内容分发的网站提供视频流开始超过P2P网络，并且逐步占据网络中90%的带宽。
>
> ​		Internet的流量特点：**Internet流量具有高度倾斜特性**，网络中的大部分流量可能都是一个设备发出，大量设备接收，另一部分微小的流量是由其他所有设备组成。**Internet流量具有突发性**，这在IP章节介绍过链路中大部分时间可能都是空闲的，然后某一时刻会突然涌现出大量的流量。
>
> ​		对于Internet流量的特点，可以构建两种类型的web站点，不受欢迎的站点可以集中所有功能再一台服务器上，由DNS将所有请求指向它，对于受欢迎的web站点没有单个服务器能够应付，需要建立内容分发系统。

> 服务器农场和Web代理
>
> ## 		**服务器农场**
>
> ​		服务器农场：使用多台计算机来充当Web服务器。模型如下。
>
> ​		服务器农场实现的**难点在于如何使得一组服务器以一个网站的形式出现。**这可以由多个实现方案，每一个方案都假设任意一台机器都可以处理来自用户的请求，这要求内一台机器上都要有一份Web站点的备份，然后用户的动态数据存放在一个共享的数据库中，所有机器都能够访问。
>
> ​		**前端：**实现用户请求的负载均很，共用服务器农场中的设备以达到性能的提升。前端的实现有两种方式。
>
> ​		**1、DNS方式**，前端是当前域中的DNS服务器，DNS服务器维护一个URL对于的IP列表，每次收到DNS请求时将列表中的IP循环给出，实现负载均衡。（当前域中的DNS服务器可以有公司自主申请设置）
>
> ​		**2、基于网络设备的方式**：前端网络设备窥视网络层、传输层、应用层的头，并以非标准的方式偷看信息，人为的为服务器农场中的各各服务器划分服务的IP地址范围，前端将请求传递给对应的服务器处理。为了保证TCP连接的正常使用，前端必须将一个连接的所有数据包交给同一台设备，这可以通过IP+端口字段解决。（查看HTTP头部可以根据Cookie将一用户的多个请求交给一台设备处理）
>
> （这里的前端设备可以时网络交换机或路由器，因为器功能特点可以把它称作中间件盒子）
>
> ![image-20210409150758495](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210409150758495.png)
>
> ## 		**Web代理**
>
> ​		Web代理：是一种可以被用户共享的一个高速缓存，这个缓存不在本地而在其他设备上。所有代理可以看作是一个二级缓存（一级缓存时浏览器本地缓存）。
>
> ​		Web代理的实现设备：从小可以时一个组织或公司的一台设备，到大可以是一个区域的ISP设备。
>
> ​		Web代理的实现：1、浏览器设置代理，访问时浏览器就会将请求发送给代理，而不是发送给网站服务器。2、网关拦截，网关先将服务器dns映射为自己的IP，然后拦截用户请求，由网关在封装后发给服务器，服务器响应后网关再将响应转发给用户。
>
> （代理作为本质上的缓存，必须保证缓存的新鲜度，需要执行WEB章节介绍的缓存机制）
>
> ​		Web代理的优势
>
> ​			1、匿名性，代理可以隐藏真正的请求者
>
> ​			2、可控性，组织或者公司可以对用户访问不良网站进行拦截

> 内容分发网络
>
> ​		服务器农场能够解决一般大型网站的需求，但对于那些在全球范围内提供内容服务的站点来说这些还不够。
>
> ​		**内容分发网络：**CDN（Content Delivery Network）彻底解决了超大型网站的服务器需求。CDN是全球或者一个区域内的不同地点设立CDN节点，每一个节点可以为这一个区域提供服务。CDN节点的内容来源于CDN源服务器。
>
> ​		**CDN网络结构：**CND网络使用传统的树形结构，该结构有3个好处，1、可扩展性好，2、用户体验好，每个用户都从离他最近的CND节点获取资源，服务器响应速度快，不容易造成瓶颈。3、网络链路总负荷低，每个节点均摊了网络流量。（整个CND网络可以看作是以棵分发树，类是IP组播中的树结构）
>
> ​		**CDN实现手段：**
>
> ​			1、使用Web代理实现：每个CDN节点作为一个Web代理，看起来可以实现，都是实用性不高，Web代理往往属于一个组织不同组织之间难以共享一个Web代理。
>
> ​			2、镜像实现：CDN节点有公司或者CDN提供商负载，每个CDN节点都是源CDN服务器的镜像具有和源服务器一样的内容。用户访问内容时源服务器会给出一个包含所有镜像节点的URL链接，用户可以自主选择距离自己最近的节点获得内容。这种方式灵活性较差，而且用户不一定或自觉的选择最好的镜像点。
>
> ​			3、DNS实现：DNS重定向，现在一个用户访问一个CDN网络时DNS服务器会根据用户请求的域名自动返回一个距离他最近的一个CND节点的IP地址，这就实现CDN最初的目的。为了实现这一目标DNS服务器必须要知道哪个节点距离用户时最近的，这要求DNS服务器了解整个网络的情况，这类似于OSPF协议的链路状态。另外DNS服务器还能够根据节点的负载情况合理分配流量。
>
> ​		**CDN运营商：**并不是所有公司都有资金和技术去打造一个属于自己的CDN网络，而使用成的CDN网络就成为了一个不错的选择，CDN运营商往往和ISP建立合作将CDN节点放置在ISP网络中获得良好的带宽服务。CDN节点对于ISP来说没有任何成本，设备和维护都由CDN运营商负责，并且CDN还能降低网络总负荷提高ISP的网络质量，这使得两者都能收益。每个CDN节点一般都是一堆集群的机器。
>
> ​		**CDN网络的使用：**一个站点租用CDN节点后，可以将大带宽的图片、视频，资源放置在CDN节点Web站点只保留页面入口，这样的方式实现很容易，只需要将原有网页中对应静态资源的链接修改成对应CDN网络的连接，然后用户请求CDN网络时，DNS服务器就会根据用户所在自动返回一个合适的CDN节点，这就实现了CDN网络的目标。(对于CDN还有一些防盗手段)
>
> （现代的云服务大概就是以CDN为雏形的产物）

> 对等网络
>
> ## **P2P**
>
> ​		**P2P：**是一个没有中央服务器的内容分发网络，这个网络由各各用户计算机组成，每个计算机都可以是一台客户机也可以是一台服务器。这些机器称为**对等节点**。P2P技术给普通用户有了畅想的空间。P2P网络可以最大化的利用所有用户的带宽资源，使得每个用户都可以获得其带宽理论上的最大值，而不用受制于网站服务器的限制。这也是P2P受欢迎的原因之一。另一个原因是CDN等中心化的结构使得大量用户信息被某个组织掌握，使得个人信息的安全性收到威胁。下面介绍两种实现P2P的协议，其中BitTorrent出现较早并且以及被广泛使用，而DHT是P2P一种更好的实现，以及在部分领域使用。
>
> ## **BitTorrent**
>
> ​		在一个P2P网络中每个用户都可以拥有其他用户感兴趣的资源，要共享这类资源就需要解决这样几个问题：
>
> ​		1、一个对等用户如何找到具有自己想要下载内容的其他对等用户（解决方法种子文件）
>
> ​		2、对等用户如何复制内容以便为大家提供高速下载（管道化，分块下载）
>
> ​		3、对等用户如何互相鼓励上传内容给他人同时为自己下载内容（抑制算法）
>
> ​		**种子文件：**是用来用户一个用户加入一个P2P网络。当一个用户想要获得某个资源时该用户必须先拿到该资源的种子文件，这个种子文件可以由任何人创建只要这个人想要共享资源。种子文件相当于一个邀请函。
>
> ​		**种子文件格式：**由跟踪器和散列值组成。
>
> ​			**跟踪器：**这是一个服务器名字，它保存了一个P2P网络的联系方式，用户可以根据这个跟踪器找到对应的P2P网络。跟踪器并不是中心化服务器，它是一个交流的节点，P2P网络独立于这个节点存在，而这一的节点可以有很多个。
>
> ​			**散列值：**种子文件中的散列值由资源的内容经过SHA-1等散列函数得到，该散列值指导用户加入哪一个P2P网络，相当于电话号码。
>
> ​		**用户加入P2P网络过程：**对于每个要加入P2P网络的用户都需要先获得种子文件，在从跟踪器获得对等节点，用户在与对等节点中的用户进行交流。跟踪器维护着一个内容的对等用户列表，每个用户需要定期和跟踪器联系说明自己处于活跃状态，否则跟踪器可能认为该节点已经离开，在列表中删除该节点，使得新加入的节点不会与这个被删除的节点建立联系。
>
> ​		**管道化：**P2P节点将资源分块，列出一个拥有的块清单，然后节点互相交换块清单，每个节点都可以请求自己没有的块，实现高速获取。这个过程优点类似于（OSPF协议中两个路由器同步LSA的过程，两个路由器发送报文描述自己LSDB总拥有的LSA信息，互相请求自己为拥有的LSA）管道化技术可以实现多个副本文件提供多倍的下载速度，一个节点可以从每个不同的节点获得不同的块。
>
> ​		**抑制算法：**在P2P网络中往往存在这样的用户，他们只获取资源然后离开，并不对P2P网络中的资源分享做出贡献。对于这样的用户往往被称为吸血鬼。为了减少这样的用户BitTorrent使用一种抑制算法来处理。抑制算法将对做出上传资源的用户友好，处于友好的节点可以和其他节点交换资源并且得到良好的速度称为非阻塞节点。而那些只获取资源从不上传资源的节点将会被抑制，从而中断与P2P中其他用户的连接。
>
> ## **DHT**
>
> ​		在BitTorrent实现的P2P网络中，为了解决如何找到对等资源的问题使用了跟踪器，这个跟踪器集中维护所有共享资源的对等网络用户列表。这就导致了P2P对于跟踪器的依赖，从而限制了P2P网络广泛使用。实际上跟踪器应该是分布式的，用户可以从任何一个跟踪器上获得对等实体信息，从而加入对等网络。而在每个跟踪器上维护相同的副本的工作难以很好的实现。
>
> ​		**DHT：**对于在P2P系统中有没有可能建立一个完全分布式的并且表现良好的P2P索引问题，研究界给出了答案。在2001年发明了4中不同的解决方案，分别是Chord、CAN、Pastry、Tapestry。因为索引的基本功能是将一个关键字映射到一个指，着不就是一个哈希表吗，当然解决方案是一个**分布式的哈希表（Distributed Hash Tables）**。
>
> ​		下面要描述的DHT解决方案是Chord。Chord方案解决了如何将一个集中式跟踪器替换成一个完全分布式的跟踪器。在这个场景下，索引表的内容是用户集群列表，索引关键字是内容的哈希值**（集中式跟踪器中一个跟踪器只维护一个内容的用户列表）**，分布式跟踪器中一个跟踪器维护多个内容的用户列表。
>
> ​		**DHT必须要回答的问题是，在缺少中央数据库的情况下如何找到一个对等节点**。即一个用户如何找到一个拥有他需要资源的用户，Chord给出了如下解决方案。
>
> ​		Chord使用标识符来导航索引，标识符组成一个环称为节点标识符这个环就是一个对等网络，网络中每个节点都是一个对等实体，这样一个环由各各对等实体组成，一个环中可以组成多个P2P网络。要加入一个P2P网络就要通过实体标识符，实体标识符由内容散列得到。（详细步骤查阅其他资料，书本上描述不清。）

