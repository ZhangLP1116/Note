> 简介
>
> ​	第一代电子邮件简单的由文件传输协议和约定组成，约定每个邮件第一行必须给出收件人地址。随着电子邮件使用越来越广泛，电子邮件最终从文件传输协议中分离出来，并增加许多新功能。

> 体系结构
>
> ​	**电子邮件系统：**由用户代理和邮件传输代理两个子系统组成，在客户机上用户通过用户代理将邮件发送给邮件传输代理，邮件传输代理将邮件传输给接收用户的传输代理。传输代理在交给用户。
>
> ![image-20210328101519739](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210328101519739.png)
>
> ​	**用户代理：**用户设备上的客户端，用来展示邮件和编辑邮件
>
> ​	**邮件传输代理：**邮件服务器上的进程，用来接收邮件并根据信封转发邮件，维护一个邮箱结构保存用户邮件，用户代理只需要展示邮箱中的邮件。
>
> ​	**电子邮件组成：**信封+邮件头+邮件体
>
> ​		信封：作用和传统意义上的信封一样，用来指导这封邮件要发送到哪里，是谁发送的。由传输代理使用
>
> ​		邮件头：包含用户代理所需要的控制信息
>
> ​		邮件体：邮件内容，由收件人查看
>
> 
>
> **为什么要有邮件传输代理，而不进行直接点对点的传输？**
>
> 1、直接点对点的传输可以实现，但不合理，发送端无法保证接收端一直在线，若不在线，发送端的邮件无法发送，因为没有人会去保存这封邮件。这不符合邮件的性质。

> 用户代理
>
> ​	用户代理是客户设备上的一个程序。可以对邮件进行各种操作：查看、排序、归档、删除等
>
> ​	用户在客户端中编辑邮件，客户端界面会列出一些传输时必要的传输让用户填写，用户代理将这些邮件封装成邮件传输代理可以处理的格式。这个格式可以时标准协议，也可以是私有协议。
>
> ​	**邮件地址的常用格式：**用户@DNS（user@dns-address）

> 邮件格式
>
> ​	**RFC5322——Internet邮件格式：**基本的ASCII电子邮件，邮件由一个信封、数个头字段、一个空行和邮件体组成。用户代理创建一个邮件并把它交给传输代理，然后传输代理利用头字段来构造出实际的信封。（P487图7-10列出来与传输有关的头字段）
>
> ​	To：主要接收人地址
>
> ​	Cc：次要接收人地址
>
> ​	Bcc：密件抄送人地址
>
> ​	From：邮件撰写人（写信的人不一定是发送邮件的人，可能通过代理发送邮件）
>
> ​	Sender：实际发送人地址
>
> ​	Received：沿途经过的邮件代理
>
> ​	Return-Path：标识邮件发送人的回复路径
>
> （用户代理和接收人使用的字段，P487图7-11）
>
> ​	**MIME——多用途Internet邮件扩展**：用来解决早期邮件只能由文本消息组成的问题。现在MIME不仅仅用在邮件发送也被广泛的用于WEB和其他应用。（在RFC5322之前就提出了MIME）
>
> ​	MIME基本思想是继续使用RFC822格式，但在邮件中增加结构性，并且为传送非ASCII码的邮件定义了编码规则。由于它没有偏离RFC822，因此已有的邮件传输代理和协议都可以发送MIME消息。
>
> ​	**MIME定义了5种新 的邮件头：（P488图7-12）**
>
> ​	MIME-Version：标识了MIME版本，告诉接收端用户代理它正在处理一条MIME消息，任何不包含该字段的邮件都被假定是英语明文消息。
>
> ​	Content-Desciption：描述邮件的可读字符串，它指出邮件包含什么内容，这个头是必须的这样接收人才知道是否值得解码和阅读该消息。
>
> ​	Content-Id：标识邮件内容，它采用了与标准Message-Id头相同的格式
>
> ​	Content-Transfer-Encoding：指出了如何包装邮件体，以便通过网络传输。早期SMTP协议处理一行不超过1000个字符的ASCII邮件，ASCII码只用每个字节的7位，二进制数据则使用每个字节的全部位数。因此需要某种方式使得携带二进制数据的邮件看起来就像常规的ASCII邮件消息一样。二进制数据的ASCII编码方式称为基于64编码（base64 encoding），这个方案中每24位为一组，分成4个6位单元，每个单元被看作是一个合法的ASCII码。
>
> ​	Content-Type：邮件内容类型，它指定了邮件体的本质，而且具有超出电子邮件范畴的影响。使得web内容和流媒体可以作为邮件内容发送。RFC1521定义了7种MIME类型。每种类型都有一个或多个子类。类型和子类之间用斜线分开：Content-Type：video/mpeg。针对每个类型都可以增加更多的子类。分配的类型和子类表由IANA在线维护www.iana.org/assigment/media-type，（P490图7-13）

> 邮件传输代理
>
> ​	邮件从发送端移交给接收端传输代理的过程使用邮件传输协议SMTP。邮件从用户代理从传输代理的过程叫做邮件提交，从传输代理到传输代理的过程叫做邮件传输，这个过程只有一跳，中间不会由多个邮件传输代理存在。
>
> ​	**SMTP：**在Internet上发送邮件的计算机首先与目标计算机的25号端口建立一个TCP连接，然后再连接上发送邮件。再这个端口上监听的是邮件服务器，它遵守SMTP协议，接收入境连接请求、执行某种安全检查接收传递过来的邮件。如果无法被投递则返回一个错误报告。（P494，一个简单的邮件服务器交互）
>
> ​	**邮件提交：**早期用户代理和邮件传输都在本地，由于开始解释的局限这种方式已经不使用了，传输代理一般是ISP或公司服务器，始终和Internet保存连接。因为ISP和公司都没有提供公共服务的义务，所以使用传输代理是需要认证，也就是用户系统。
>
> ​	**邮件传送：**一旦接收到来自用户代理的邮件后，传输代理使用SMTP将邮件发送给接收端的邮件代理。过程如下：
>
> ​	1、邮件代理查询DNS
>
> ​	2、建立TCP连接
>
> ​	3、发送邮件

> 邮件接收
>
> ​	IMAP：邮件的接收要求允许用户远程对邮箱进行操作，提供这个功能的协议有很多但SMTP不再其中。IMAP协议（Internet Message Access Protocol）提供了这种功能，它运行再143端口，用户代理必须运行IMAP客户端。两者交互的命令（P498图7-17）
>
> ​	Webmail：一种日益流行的可以提供电子邮件服务的是Web，它利用接口来发送和接收邮件。这种体系中邮件传输代理不变，用户代理不再是一个独立的程序，而是一个界面，由后端服务器提供用户代理的功能。