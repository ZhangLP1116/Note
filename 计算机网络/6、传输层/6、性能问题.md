> 网络中的性能问题
>
> ​	理解网络性能更像一门艺术，而不是学科。这很少有可在实践中应用的基础理论。
>
> ​	1、临时资源过载引发的网络拥塞
>
> ​	2、由于将一个坏段发送给1000台计算机导致的广播风暴
>
> ​	3、突然断电后导致的大量同步请求
>
> 。。。。。。
>
> 复杂的实际情况会造成各式各样的网络问题。而这些问题的解决需要经过网络测量发现问题的所在。
>
> 良好的设计可以从源头减少网络性能问题的发生
>
> 对特定场景的特殊处理也可以避免发生网络问题

> 网络测量
>
> ​	为了找出真正的问题所在，操作人员需要对网络进行正确的测量，测量时应该小心的避免以下陷阱。
>
> ​	**确保样值空间足够大：**测量的数据量要够大
>
> ​	**确保样值具有代表性：**测量的范围要够宽，如同一天多个时间点进行测量，一个月多天进行测量
>
> ​	**缓存可以破坏测量结果：**大多主机具有缓存功能，它们会将TCP数据包缓存到一定数量后在发送出去，而在应用程序看来这些数据包已经被发生出去。导致错误推论。
> ​	确保测量期间不会发生不可知事情：避免不必要的干扰
>
> ​	**小心使用粗粒度时钟：**时钟并不总是和返回事件一样精确
>
> ​	**小心推断结果：**

> 针对快速网络的主机设计
>
> ​	经验表明性能的瓶颈通常不在网络而在主机。
>
> ​	**主机速度比网络速度更重要：**在高速网络中操作系统和协议开销占据着线路的主要实际时间。
>
> ​	**减少包技术带来的开销：**每个网络层、传输层都有各自的头部开销，使用尽量大的数据包比大量的小数据包效率更高。
>
> ​	**最小化数据预取：**实现分层协议最简单的方法是每一层用一个模块实现。这就会导致一个数据包在分析时被多次的复制，内存操作比寄存器操作慢了一个量级。聪明的操作系统通常把多层次处理结合在一起。
>
> ​	**最小化上下文切换：**每一次的上下文切换都需要保护现场，触发内核态到用户态的变迁。非常浪费CPU时间，这就是为什么把传输协议实现在内核中的理由

> 快速处理段
>
> ​	段的处理开销分为两部分：1、每个段的处理开销，2、每个字节的处理开销
>
> ​	通常情况下，连续的数据段头部几乎都是相同的。为了充分利用这个实时，传输实体应该在内部保持一个原型头。在发送新段时将这个原型头复制到缓冲区中，再将不同的字段覆盖掉原型头中的字段。（P456图6-52表示了一般需要修改的字段）
>
> ​	快速处理路径：在第一次通信后，可以将建立连接的记录保存在哈希表中，在下次处理时查找哈希表就能找到对应的记录。加速连接查找的优化手段时维护一张近期连接记录表，类似高速寄存器的作用。
>
> ​	计时器管理：一个良好的计时器管理可以减少系统的负担（P457或操作系统中的计时器管理）

> 头压缩
>
> ​	头压缩以减少高层协议带来的头部开销。常用的压缩方法可以将40字节的TCP/IP头部压缩到3字节。方法是传输大量相同头部数据包时省略其中相同的字段。

> 长肥网络协议
>
> ​	长肥网络是指一条跨越长距离的高速链路。该链路的特点时发送端发送数据速度快，数据在路径上传输的速度远大于发送速度，导致发送端需要等待很长时间才能收到接收端的确认消息，使得链路使用效率底下。类似于长距离的卫星信道。这就要求运行在这样链路上的协议充分技术带宽延迟乘积，管道化传输数据，提高链路利用率。