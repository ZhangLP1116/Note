> 寻址
>
> ​	传输层完成跨越网络的进程间的数据传输，在网络层中要给一个计算机发送数据需要用到IP等形式的地址找到目标计算机。那么在传输层上一个计算机的进程如何找到另一个计算机上的进程呢？——寻址就是为了解决这个问题。
>
> ​	在操作系统中用端口来表示一个进程的传输地址，成为**传输服务访问点**（TSAP，Transport Service Access Point）。同理网络层的地址被叫做**网络服务访问点**（NSAP，Network Service Access Point）。
>
> ​	进程通过绑定到端口实现寻址。在传输层协议中目的端口的大小为2字节，一共有65536个端口可以被寻址。传输层数据段中通过指定目标端口即可实现与远程进程的通信。
>
> ​	那么如何知道远程进程绑定在那个端口呢？
>
> ​	1、0~1023属于知名端口，这些端口被一些应用固定使用，如FTP对于20、21端口。或者通过端口映射器（它总是在监听知名端口），用户通过给它发送请求的服务名称，它就会返回一个端口地址。然后用户释放与端口映射器之间的连接，在与所需服务建立一个新的连接。
>
> ​	2、对于用户自定义端口，端口号在1024~65535之间。可以通过客户端内置配置文件得知服务器进程所在端口位置。或者通过
>
> ​	在实际操作系统中并不是每一个知名端口上都有对应的服务进程在等待连接，而是使用一个初始连接协议，通过一个特殊的进程来监听所有端口，当有对应的请求到来时在拉起对应的服务进程进行服务。

> 建立连接
>
> ​	通信双方在知道地址后并不一定是直接进行通信，在面向连接的协议中需要先进行连接的建立。建立连接是一个初始化协商的过程，以保证后续传输的可靠性。面向连接协议中必不可少的步骤。
>
> ​	**在网络一个影响可靠性的问题是**——因为延迟重传一个数据包，在接收方接收到了两个数据包。
>
> ​	解决方法：接收方维护一张表，其中包含以及接收过的数据包，每次接收数据包时查早该表，拒收存在表中的数据包。这个方法有一个问题，在于延迟的数据包不知道多久后会到来，接收方要一直维护着数据表。
>
> ​	**数据包生存周期：**数据包在一个特定长的时间后被认为失效，路由器将直接丢弃这个数据包。这样上述的解决方法就不需要长时间维护一张不断增长的表。但是还存在一个问题，主机突然崩溃丢失保存的数据包怎么办？一种解决方法是在崩溃后空闲T秒后在进行服务（T是数据包最大生存周期）。另外一种解决办法是——日时钟。
>
> ​	**日时钟：**主机维护一个时钟，这个时钟在主机崩溃的情况下也不停止工作。主机根据时钟的位数信息作为数据包的序号。时钟位数要足够长，使得下一次回绕时以及超过数据包的生产周期。在使用日时钟的方案下，主机崩溃后可以立刻在进行服务，重启后的时钟序号和崩溃前的时钟序号之间存在一个禁区，落在这个禁区中的数据包不会被接收（P397图6-10）
>
> ​	**三次握手：**TCP采用3次握手协议来建立连接
>
> ​	1、发送Connect Request(seq=x)数据包，请求建立连接
>
> ​	2、回复ACK(seq=y，ACK=x)数据包，回复确认
>
> ​	3、发送第一个数据包DATA(seq=x，ACK=y)传输并确认初始序列号。
>
> ​	在初始交互过程中只要有ACK确认序列号对不上的情况就无法建立连接。（P399图6-11）
>
> ​	**PASW：**防止序号回绕机制。在越来越快的链路上固定长度的序列号无法满足在数据包生存周期内不出现回绕现象，所以使用32位的时间戳来辅助序号防止发生回绕。
>
> ​	伪随机初始序号：有规律的时钟序号使得恶意的攻击者很容易推导出下一个数据包的序号从而伪装成连接者骗取3次握手，截取数据。所以才使用伪随机生成的序号。同样的伪随机序号也要求在周期T内不发生回绕。

> 释放连接
>
> ​	**非对称释放连接：**该方式就像挂电话，只要一方挂断连接就中断，在网络传输中可能导致数据丢失，即己方数据传输完毕，对方还在传输数据的情况。
>
> ​	**对称释放连接：**只有两方都结束连接，连接才真正断开。在TCP协议这种双工的传输协议中每次一方断开连接仅仅是断开己方发送数据的通道，此时还能接收数据但无法发送数据。当对方也断开连接后连接才真正断开。
>
> ​	**四次挥手：**断开连接
>
> ​	1、A发送DR(Disconnect Request)
>
> ​	2、B发送ACK
>
> ​	3、B发送DR
>
> ​	4、A发送ACK

> 差错控制和流量控制
>
> ​	差错控制：检错码、序列号
>
> ​	流量控制：滑动窗口（缓存区分配P404）

> 多路复用
>
> ​	NASP复用：正常情况下多个端口可以使用一个网络地址进行数据传输。
>
> ​	逆向多路复用：一个端口享用多个网络地址，提高带宽（SCTP协议）

> 崩溃恢复
>
> ​	网络中路由器等传输设备的崩溃可以简单的恢复，主机内的传输实体总是在等待未到来的数据。
>
> ​	主机上的崩溃在传输层就难以完美的恢复，一般结论是，从第n层崩溃中恢复，只能由n+1层完成。

