> 链路层的目的：为网络层提供服务。
>
> 链路层从网络层接收数据包，将数据包封装成帧，然后交给物理层进行比特流传输。
>
> 链路层从物理层接收比特流，将其中的帧头帧尾去除，交给网络层。

> 链路层为网络层的不同协议提供不同的服务
>
> 1、**无确认无连接服务：**源计算机向目标计算机发送独立的帧，目标机不对这些帧进行确认。如以太网协议，常用于信道较好的场合，和对实时性要求高的服务。
>
> 2、**有确认无连接服务：**数据链路没有使用逻辑连接，但是对于发送方的每一帧接收方都需要回复确认，若长时间无回复则认为数据帧丢失，发送方重发数据帧，以确保数据帧能够达到，常用于不可靠信道。如802.11（wifi）。（一帧一帧的发，确保顺序）
>
> 3、**有确认有连接服务：**收发双方建立逻辑连接，为每个帧进行编号，确保每个帧能够正确达到。并且每个帧都按照正确的顺序只被接收一次。（连续发送数据帧，用编号确保循序）

> 链路层需要实现的功能
>
> 为了功能给为了成层提供服务，链路层需要实现一些功能
>
> 1、向网络成提供一个定义良好的服务接口（成帧）
>
> 2、处理传输错误（差错控制）
>
> 3、调节数据流，确保慢速的接收方不会被快速的发送方淹没。（流量控制）

> 成帧
>
> Q：为什么需要成帧？
>
> A：链路层从物理层接收到的是比特流，链路层需要将其中的数据包交给网络层，这就由两个要求，数据包完整性，数据包的顺序。
>
> 为了这两个目的，链路层就需要从比特流中分离出每个数据包，对每个数据包进行验证和排序，处理完之后再将这些数据包交给网络层。为了正确的分离处数据包，链路层需要在接受网络层数据包时对其进行处理，以便接收方能够区分出每个数据包，这就是成帧。
>
> 
>
> **成帧的方法：**1、字节计数（不常用）；2、字节填充；3、比特填充；4、物理层编码违禁法（不常用）
>
> **字节计数法：**用帧开头的第一个字节表示帧共有多少字节，这样链路层就知道一个帧的结束。（计数字节包含在长度内），该方法的缺点是，当计数字节发生错误后，其后整个比特流中的帧都无法正确的分离。（P154图3-3）
>
> 字节填充法：在每个帧的前后都插入标志位表示帧的分界，即使一个标志位损坏也不会影响下一个帧被正确区分。
>
> 该方法还需要处理一些问题：1、当传输二进制文件时，帧分界的标志位和数据包中的某些字节重复（处理方法是在数据包中的标志位前加入转义字符ESC），2、当加入的转义字符与数据包中的转义字符重复（解决方法是在转义字符前再加入一个转义字符）。
>
> 接收方在接收帧是通过FLAG分离出帧，再将帧内部的ESC去除。（P155图3-4）（PPP协议使用这种成帧方法）
>
> **比特填充法：**与字节填充法的不同之处在于比特填充法在比特流级填充标志，不需要使用8bit字节长度。每个帧的开始和结束都是一个特殊的比特模式：如01111110或十六进制0x7E标记。处理数据包中具有同样内容的字节是，比特填充方法是在遇到连续的五个1后面插入一个0以编码冲突，这个0和转义字符的作用一致，但只需要一个bit。
>
> 接收方在接收时只需要根据规定的比特模式找出每个帧的开始和结束，然后将数据包中每连续五个1后的0去掉即可得到原始数据。（由HDLC协议开发，常用在USB中）（P155图3-5）
>
> **物理层编码违禁法：**在物理层中为了保护数据bit而加入的冗余bit位作为帧的开始和结束，作用很容易区分帧的分界。
>
> 
>
> 实际使用中许多链路协议为了安全起见，结合使用了这些方法。以太网和802.11使用了共同的分界模式，即用一个定义良好的比特模式来标识一个帧的开始，这个比特模式称为前导码（802.11使用72位）。前导码之后是一个长度字节，用来定位帧的结束。并没有统一使用比特模式统一控制帧的开始和结束。

> 差错控制：确保所有帧都被传递给目标机器的网络层，并且保持正确的顺序。
>
> 在无确认无连接服务中，无序确保差错控制，发送方只需要发出数据帧即可。
>
> 在面向连接的服务中，就需要确保数据帧被接收，并且没有损坏，保证接收方的数据包顺序正确。
>
> **控制帧、时钟和编号**
>
> 控制帧：确保可靠传递的常用方法是发送方要求接收方在接收到数据包后回复一个控制帧，确认帧被正确接收，或者帧损坏需要重新发送。
>
> 时钟：在一些情况下，接收方的控制帧丢失导致发送方一直等待，或者发送的帧丢失接收方一直没有收到帧，这时候发送方需要引入一直时钟，当数据帧发送后启动计时器，当计时器超时后发送方重传数据帧。直到接收到确认后停止时钟。
>
> 编号：发送方没有收到控制帧时接收方存在两种情况，一、需要重传数据帧的情况：发送方的数据帧丢失、接收方的控制帧丢并且数据帧损坏。这时需要发送方重传。二、接收方控制帧丢失，但接收方已经接收到正确的数据帧。这时候发送方由于计时器超时触发重传，导致接收方接收到一个重复的数据帧，交给网络层，导致错误。这时候就需要一个数据帧编号，来统一双方的帧。

> 流量控制
>
> 接收方无法以数据到来的速度那样持续的处理帧，此时势必会丢弃一些帧。
>
> 常用两种方法来阻止：基于反馈的流量控制、基于速率的流量控制
>
> 基于反馈的流量控制：原理是在没有接收方许可之前（显示或隐式），禁止继续发送帧。后续会有简单的实现。
>
> 实际情况中，当下网络接口卡（NIC）的处理速度远大于数据帧到来的速度，所以过载不在是链路层需要担心的问题，而是上层需要关注的问题。
>
> 基于速率的流量控制将在传输层介绍