1、故障分类

> **1、事务故障：**表现为一个事务不能正常执行下去
>
> （1）可以预期的事务故障：即在程序中可以预先估计到的错误，如存款余额透支，库存过低。这些错误可以在程序中被检测并且通过rollback手段滚回。
>
> （2）非预期的事务故障：在程序中发生的未估计到的错误，如运行溢出，并发事务死锁等。此时由系统直接对事务这些UNDO处理

> **2、系统故障：**引起系统停止运作随之要求重启的故障。如硬件故障、软件故障、系统断电等。系统故障会导致正在运行的所有事务被丢失。
> （1）尚未完成的事务：事务进行到一般但还未结束的事务
> （2）已提交的事务：已提交的事务但还未将结果写入存储器的事务

> **3、介质故障：**系统故障常称为软故障，介质故障称为硬故障。如磁盘损坏，物理数据库遭到毁灭性破坏。

2、恢复策略

> **1、事务故障的恢复：**事务故障恢复由系统自动完成，无需用户干预
>
> （1）：从前到后扫描日志，找到故障事务
> （2）：撤销该事务已做的所有更新。
> （3）：从正在运行的事务列表中删除该事务

> **2、系统故障的恢复：**
>
> （1）：重启OS和DBMS
> （2）：从前向后扫描故障前已提交的事务，将该事务ID添加到REDO队列中。找出未提交的事务，将其事务ID添加到UNDO队列中
> （3）：对撤销队列中的事务进行撤销处理，具体方法时反向扫描日志，对每个要撤销的事务进行退回操作
> （4）：对重做队列中的事务进行重做处理，具体方法时正向扫描日志，对每个事务重新执行日志文件登记

> **3、介质故障的恢复：**
> （1）：修复或更换磁盘，并重启系统
> （2）：装入最近的数据库后备副本，使数据库恢复到最近一次转存储状态
> （3）：装入有关日志副本，重做REDO事务

3、具有检查点的恢复技术

> 上面提到了故障恢复时，需要查找日志，将已提交的事务重做，未提交的事务撤销。那么需要传统开始扫描日志，将所有已提交的事务REDO吗？明显是不需要的，将远离故障发生点之前完成的事务重做是非常愚蠢的。
>
> 所有mysql中引入了检查点机制，即每个一段时间设置一个检查点，该检查点之前没有任何故障发生。当故障发生时只需要从最近的一个检查点后开始扫描日志进行恢复操作即可。