> 前景回顾
>
> ![image-20210225170242948](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225170242948.png)
>
> ![image-20210225170342850](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225170342850.png)
>
> 锁方案的局限：互斥性好但同步性不足，临界区内只能由一个进程，无法实现一个进程在临界区进行写操作，一个进程在临界区内进行读操作。

> 信号量介绍
>
> 信号量是一个整型，由两个原子操作：P操作和V操作
>
> 如图当两个列车进入临界区后，信号量为0，第3个列列车等待，当有一个列车离开后，信号量加1，唤醒等待的列车进入临界区。（V操作中sem<=0表示操作由进程在等待，此时可以唤醒该进程）
>
> ![image-20210225171309851](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225171309851.png)
>
> ![image-20210225171638674](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225171638674.png)
>
> 

> 信号量使用
>
> ![image-20210225171847797](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225171847797.png)
>
> ![image-20210225172251973](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225172251973.png)
>
> 信号量实现互斥（信号量初值为1）
>
> ![image-20210225172448805](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225172448805.png)
>
> 信号量实现同步操作
>
> 如下线程A必须在线程B完成对应的V操作之后才能执行P之后的操作。此时信号量的初始值为0
>
> ![image-20210225172656364](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225172656364.png)
>
> 二进制信号量无法同时满足同步和互斥操作
>
> ![image-20210225172947774](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225172947774.png)
>
> ![image-20210225173401707](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225173401707.png)
>
> 实现
>
> mutex信号量控制生产者和消费者线程之间的互斥性。fullbuffers控制缓冲区是否为满，emptyBuffers控制缓存器是否为空
>
> Deposit是生产者行为：产生物品到buffer
>
> Remove是消费者行为：从buffer中取数据
>
> ![image-20210225173524932](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225173524932.png)
>
> 互斥性的实现
>
> 在关键动作前后使用mutex信号量，实现进入临界区和退出临界区的互斥互斥性
>
> ![image-20210225174009401](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225174009401.png)
>
> 同步性实现
>
> 生产者端：emptybuffers代表可填充数，每次放入产品都会使得可填充数减一。fullBuffers代表现有数量，每次放入产品都会使得其数量增加。
>
> 消费者端：emptybuffers带表可填充数，每次取出产品都会使得可填充数增加。fullBuffers可取数量，每次获取都会使得该数量减一。
>
> 这样即可实现生产者在buffer为满时等待对应emptybuffer<0，消费者在buffer为空时等待fullBuffers<0
>
> ![image-20210225174525390](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225174525390.png)
>
> 

> 信号量实现
>
> ![image-20210225184454824](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225184454824.png)

> 总结
>
> ![image-20210225184625257](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20210225184625257.png)