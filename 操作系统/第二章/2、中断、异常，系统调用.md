> 操作系统需要实现的几个方面（interface，接口、界面）
>
> 1、系统调用
>
> 2、异常
>
> 3、中断

> **定义：系统调用：**来源于应用程序，应用程序主动向操作系统发出服务请求
>
> **处理时间**：异步或同步
>
> **响应**：等待系统调用后进行执行应用程序

> **定义：异常：**来源于不良应用程序，非法指令或者其他坏的处理状态
>
> **处理时间**：同步
>
> **响应**：杀死或重新执行意想不到的应用程序指令

> **定义：中断：**来源于外设，由外设产生的中断信号
>
> **处理时间**：异步
>
> **响应**：由操作系统处理，对用户应用程序是透明的，无感知的

> 中断异常处理机制
>
> 操作系统维护一张中断异常表，由事件ID和程序入口地址两部分组成。产生对应中断或者异常时只需要查找表中对应的ID，转跳到对应的程序入口地址执行即可。
>
> **中断的处理可以参考计算机原理中的“中断处理”。**
>
> **在硬件方面：**在外设产生中断时，会有对应的接口芯片产生对应的中断号用于表示同一类型不同设备、或者不同类型的中断，在CPU在读取到中断号后不会直接转到对应的服务程序，而是交给操作系统，由操作系统判断应该怎么处理该中断。
>
> **在软件方面：**若操作系统决定处理中断，先会保护现场，在进行中断处理、在清除中断标记、恢复现场
>
> 
>
> **异常处理：**程序运行出现异常CPU将异常ID号交给操作系统，操作系统保存现场、处理异常（杀死产生了异常的程序或重新执行异常指令）、恢复现场

> 系统调用
>
> 当应用程序需要操作系统提供服务时，可以通过系统提供的接口进行系统功能的调用
>
> 例子：
>
> ![image-20210202141310006](image\image-20210202141310006.png)
>
> 在实际系统中应用程序访问的主要是通过高层次的API接口而不是直接进行系统调用。
>
> 例：
>
> ![image-20210202141809017](image\image-20210202141809017.png)

> 用户态：无法执行一些特殊指令
>
> 内核态：可以执行任何指令

> 当应用程序进行一些特殊的系统调用时，操作系统就会从用户态转变到内核态从而去执行对应的指令。在这个过程中从原本的应用程序直接调用API，变成了应用程序调用API，操作系统进行内核接口调用。
>
> ![image-20210202143251650](image\image-20210202143251650.png)

> **系统调用和函数调用的区别**
>
> 函数调用时只在一个栈空间完成，而系统调用时应用程序和内核拥有各自的堆栈，所以进行系统调用时除了特权级的切换还存在堆栈的切换。所以系统调用的开销也会大，同时带来的时更高的安全性

> 深层系统调用时需要跨越系统边界（从外壳到内核，从用户到内核），其存在的开销如下
>
> ![image-20210202143859645](image\image-20210202143859645.png)