

```
//ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªå­—ç¬¦è§„å¾‹ pï¼Œè¯·ä½ æ¥å®ç°ä¸€ä¸ªæ”¯æŒ '.' å’Œ '*' çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ 
//
// 
// '.' åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ 
// '*' åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´  
// 
//
// æ‰€è°“åŒ¹é…ï¼Œæ˜¯è¦æ¶µç›– æ•´ä¸ª å­—ç¬¦ä¸² s çš„ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚ 
//
// ç¤ºä¾‹ 1ï¼š 
//
// 
//è¾“å…¥ï¼šs = "aa", p = "a"
//è¾“å‡ºï¼šfalse
//è§£é‡Šï¼š"a" æ— æ³•åŒ¹é… "aa" æ•´ä¸ªå­—ç¬¦ä¸²ã€‚
// 
//
// ç¤ºä¾‹ 2: 
//
// 
//è¾“å…¥ï¼šs = "aa", p = "a*"
//è¾“å‡ºï¼štrue
//è§£é‡Šï¼šå› ä¸º '*' ä»£è¡¨å¯ä»¥åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ , åœ¨è¿™é‡Œå‰é¢çš„å…ƒç´ å°±æ˜¯ 'a'ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸² "aa" å¯è¢«è§†ä¸º 'a' é‡å¤äº†ä¸€æ¬¡ã€‚
// 
//
// ç¤ºä¾‹ 3ï¼š 
//
// 
//è¾“å…¥ï¼šs = "ab", p = ".*"
//è¾“å‡ºï¼štrue
//è§£é‡Šï¼š".*" è¡¨ç¤ºå¯åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªï¼ˆ'*'ï¼‰ä»»æ„å­—ç¬¦ï¼ˆ'.'ï¼‰ã€‚
// 
//
// 
//
// æç¤ºï¼š 
//
// 
// 1 <= s.length <= 20 
// 1 <= p.length <= 20 
// s åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ã€‚ 
// p åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ï¼Œä»¥åŠå­—ç¬¦ . å’Œ *ã€‚ 
// ä¿è¯æ¯æ¬¡å‡ºç°å­—ç¬¦ * æ—¶ï¼Œå‰é¢éƒ½åŒ¹é…åˆ°æœ‰æ•ˆçš„å­—ç¬¦ 
// 
//
// Related Topics é€’å½’ å­—ç¬¦ä¸² åŠ¨æ€è§„åˆ’ ğŸ‘ 3938 ğŸ‘ 0

```

pè¦èƒ½å®Œå…¨åŒ…å«så¹¶ä¸”ä¸èƒ½æœ‰å¤šä½™å­—ç¬¦

```
s=ab
p=abc
ï¼ˆä¸åŒ¹é…ï¼‰
s=ab
p=abc*
ï¼ˆåŒ¹é…ï¼‰
```



### é€’å½’

- å°†å¸¦`*`çš„çœ‹ä½œä¸€ç»„è¿›è¡ŒåŒ¹é…ï¼Œ`a*`ï¼Œæ­¤æ—¶å¯ä»¥åŒ¹é…0ä¸ªæˆ–è€…å¤šä¸ªä¸¤ç§æƒ…å†µåˆ†æ”¯å‘ä¸‹é€’å½’
- ä¸å¸¦`*`å·ï¼Œå•å­—ç¬¦åŒ¹é…ç›¸ç­‰åˆ™ç»§ç»­ï¼Œä¸ç›¸ç­‰åˆ™ä¸åŒ¹é…
- å¾…åŒ¹é…å­—ç¬¦ä¸²`s`éå†ç»“æŸåˆ¤æ–­ï¼Œå­—ç¬¦ä¸²pæ˜¯å¦ä¹Ÿèƒ½åˆ°è¾¾ç»“å°¾ï¼Œè‹¥èƒ½åˆ™åŒ¹é…ï¼Œä¸èƒ½åˆ™ä¸åŒ¹é…

```java
class Solution {
    public boolean isMatch(String s, String p) {
        char[] chars = s.toCharArray();
        char[] matchChars = p.toCharArray();
        return doMatch(chars, matchChars, 0, 0);
    }

    public boolean doMatch(char[] chars, char[] matchChars, int i, int j){
        while (i >= 0 && i < chars.length) {
            if (j >= matchChars.length){
                return false;
            }
            if(j + 1 < matchChars.length && matchChars[j + 1] == '*' ){// å¸¦*

                if ((matchChars[j] == '.' || matchChars[j] == chars[i])){
                    if (doMatch(chars, matchChars, i + 1, j)){// åŒ¹é…1ä¸ªï¼Œç»§ç»­ä¸‹æ¢
                        return true;
                    }else if (doMatch(chars, matchChars, i, j + 2)){// åŒ¹é…0ä¸ª
                        return true;
                    }
                    return false;
                }else {
                    // åŒ¹é…0ä¸ª
                    j += 2;
                    continue;
                }

            }
            if (matchChars[j] == '.'){
                j++;
                i++;
                continue;
            }
            if (matchChars[j] == chars[i]){
                j++;
                i++;
                continue;
            }
            return false;
        }
        return  i >= chars.length && isCanEnd(matchChars, j);
    }

    public boolean isCanEnd(char[] matchChars, int j) {
        while (j < matchChars.length) {
            if ('*' == matchChars[j]){
                j++;
                continue;
            }
            if (j + 1 < matchChars.length && matchChars[j + 1] == '*'){
                j += 2;
                continue;
            }
            return false;
        }
        return true;
    }
}
```

![image-20240815155632034](image/image-20240815155632034.png)

#### å†™æ³•ä¼˜åŒ–

```java
class Solution {
    public boolean isMatch(String s, String p) {
        char[] chars = s.toCharArray();
        char[] matchChars = p.toCharArray();
        return doMatch(chars, matchChars, 0, 0);
    }

    public boolean doMatch(char[] chars, char[] matchChars, int i, int j){
        while (i >= 0 && i < chars.length) {
            if (j >= matchChars.length){
                return false;
            }
            if(j + 1 < matchChars.length && matchChars[j + 1] == '*' ){// å¸¦*
                return doMatch(chars, matchChars, i, j + 2) || ((matchChars[j] == '.' || matchChars[j] == chars[i]) && doMatch(chars, matchChars, i + 1, j))

            }
            if (matchChars[j] == '.'){
                j++;
                i++;
                continue;
            }
            if (matchChars[j] == chars[i]){
                j++;
                i++;
                continue;
            }
            return false;
        }
        return  i >= chars.length && isCanEnd(matchChars, j);
    }

    public boolean isCanEnd(char[] matchChars, int j) {
        while (j < matchChars.length) {
            if ('*' == matchChars[j]){
                j++;
                continue;
            }
            if (j + 1 < matchChars.length && matchChars[j + 1] == '*'){
                j += 2;
                continue;
            }
            return false;
        }
        return true;
    }
}
```

#### è®°å¿† + é€’å½’

```java
class Solution {
    Boolean[][] flag;// å­˜å‚¨ï¼Œiã€jå‚æ•°çš„è°ƒç”¨ç»“æœï¼Œæå‰æå‰ª
    public boolean isMatch(String s, String p) {
        char[] chars = s.toCharArray();
        char[] matchChars = p.toCharArray();
        flag = new Boolean[s.length() + 1][p.length() + 1];
        return doMatch(chars, matchChars, 0, 0);
    }

    public boolean doMatch(char[] chars, char[] matchChars, int i, int j){
        if (flag[i][j] != null){
            return flag[i][j];
        }
        while (i >= 0 && i < chars.length) {
            if (j >= matchChars.length){
                flag[i][j] = false;
                return flag[i][j];
            }
            if(j + 1 < matchChars.length && matchChars[j + 1] == '*' ){// å¸¦*
                flag[i][j] = doMatch(chars, matchChars, i, j + 2) || ((matchChars[j] == '.' || matchChars[j] == chars[i]) && doMatch(chars, matchChars, i + 1, j));
                return flag[i][j];

            }
            if (matchChars[j] == '.'){
                j++;
                i++;
                continue;
            }
            if (matchChars[j] == chars[i]){
                j++;
                i++;
                continue;
            }
            flag[i][j] = false;
            return flag[i][j];
        }
        flag[i][j] = i >= chars.length && isCanEnd(matchChars, j);
        return  flag[i][j];
    }

    public boolean isCanEnd(char[] matchChars, int j) {
        while (j < matchChars.length) {
            if ('*' == matchChars[j]){
                j++;
                continue;
            }
            if (j + 1 < matchChars.length && matchChars[j + 1] == '*'){
                j += 2;
                continue;
            }
            return false;
        }
        return true;
    }
}
```





### åŠ¨æ€è§„åˆ’

å‚è€ƒï¼š

https://leetcode.cn/problems/regular-expression-matching/solutions/531001/dong-tai-gui-hua-di-gui-xiang-jie-by-tin-oycu/

https://leetcode.cn/problems/regular-expression-matching/solutions/809586/dai-ma-hui-shuo-hua-dong-tai-gui-hua-hao-b3zh/



æˆ‘ä»¬è®¾ç½®åŠ¨æ€è½¬ç§»æ–¹ç¨‹ä¸º dp\[i][j] = true || falseï¼Œè¡¨ç¤ºsçš„å‰iä¸ªå­—ç¬¦å’Œpçš„å‰jä¸ªå­—ç¬¦æ˜¯å¦åŒ¹é…ã€‚æ³¨æ„ï¼Œå‰iä¸ªçš„æ„æ€æ˜¯ ä¸‹æ ‡ä»0åˆ°i-1,æœ«å°¾çš„å…ƒç´ å¯¹åº”çš„ä¸‹æ ‡åˆ†åˆ«æ˜¯ i - 1 å’Œ j - 1.

**é¦–å…ˆçœ‹base caseã€‚**

dp\[0][0]è¡¨ç¤º s çš„ç©ºä¸²å’Œ p çš„ç©ºä¸²çš„åŒ¹é…æƒ…å†µï¼Œé‚£ä¸€å®šæ˜¯åŒ¹é…çš„ã€‚

dp\[0][j] çš„è¡¨ç¤ºpä¸æ˜¯ç©ºä¸²ï¼Œsæ˜¯ç©ºä¸²çš„æƒ…å†µã€‚æ¯”å¦‚ `s = "", p = "a*b*"` .

dp\[0][1] è¡¨ç¤º pçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¹Ÿå°±æ˜¯ p[0] = a æ˜¯å¦å’Œ s åŒ¹é…ï¼Œæ˜¾ç„¶æ˜¯ä¸åŒ¹é…çš„ï¼Œå¹¶ä¸”dp\[0][1] ä¸€å®šæ˜¯ falseï¼Œå› ä¸ºä¸ç®¡æ˜¯ä»€ä¹ˆå­—ç¬¦ï¼Œå®ƒéƒ½æ¯” s ä¸²å¤šä¸€ä¸ªã€‚å³ä½¿æ˜¯`'*'`ä¹Ÿä¸è¡Œï¼Œå®ƒæ— æ³•æ¶ˆé™¤æ‰è‡ªå·±ï¼Œå› ä¸º `'*' `éœ€è¦æ ¹æ®ä¸Šä¸€ä¸ªå­—ç¬¦æ¥åŒ¹é…ã€‚

å†å¾€å dp\[0][2]ï¼Œp[1] = `'*'`ï¼Œå®ƒå¯ä»¥é€‰æ‹©æ¶ˆé™¤æ‰ç¬¬ä¸€ä¸ªå­—ç¬¦aï¼Œé‚£ä¹ˆè¿™ä¸ªå­ä¸²å°±ä¹Ÿå˜æˆäº†ä¸€ä¸ªç©ºä¸²ï¼Œå› æ­¤æ˜¯åŒ¹é…çš„ã€‚

å†å¾€åæ¨ï¼Œdp\[0][3]ä¸º falseï¼Œdp\[i][4] å› ä¸º p[3]æ˜¯ `'*'` æ‰€ä»¥å¯ä»¥æ¶ˆé™¤æ‰å‰é¢çš„bï¼ŒåŒæ—¶ç¬¬ä¸€ä¸ª `'*'` å¯ä»¥æ¶ˆé™¤æ‰ aï¼Œæ‰€ä»¥æ•´ä½“påˆå˜æˆäº†ä¸€ä¸ªç©ºä¸²ï¼Œæ˜¯åŒ¹é…çš„ã€‚

æ®æ­¤æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºæ¥ä¸€ç‚¹è¿™ä¸ªè§„å¾‹äº†ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªè§„å¾‹æŠŠbase caseåˆå§‹åŒ–å®Œï¼š

```
dp[0][i] = p.charAt(i - 1) == '*' && dp[0][i - 2] 
```

**æ¥ç€çœ‹æ™®éæƒ…å†µä¸‹çš„çŠ¶æ€è½¬ç§»**ã€‚

å¦‚æœ s[i-1] == p[j-1]ï¼Œä¹Ÿå°±æ˜¯så’Œpå¯¹åº”çš„éƒ½æ˜¯æ™®é€šå­—ç¬¦ä¸”ç›¸ç­‰çš„è¯ï¼Œè¿™ s[i-1]å’Œp[j-1]è¿™ä¸¤ä¸ªå­—ç¬¦å°±æ˜¯åŒ¹é…çš„ï¼Œé‚£ä¹ˆ[0, i-1]å’Œ[0, j-1] å¯¹åº”çš„è¿™ä¸¤ä¸ªå­ä¸²åŒ¹ä¸åŒ¹é…å°±è¦çœ‹å‰é¢çš„å­ä¸²çš„åŒ¹é…æƒ…å†µäº†ã€‚è¿™é‡Œå¦‚æœp[j-1]æ˜¯`'.'`ï¼Œé‚£ä¹ˆs[i-1] ä¹Ÿå¿…ç„¶å’Œ p[j-1]ç›¸ç­‰ï¼Œå› ä¸º `'.'`å¯ä»¥åŒ¹é…ä»»ä½•å­—ç¬¦ã€‚æ‰€ä»¥ç¬¬ä¸€ç§æƒ…å†µæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºæ¥äº†:

```java
if (p.charAt(j - 1) == '.' 
                || p.charAt(j - 1) == s.charAt(i - 1)) {
    dp[i][j] = dp[i - 1][j - 1];
}

```

**é‚£ä¹ˆå¦‚æœ p[j-1] == '\*' å‘¢ï¼Ÿè¿™æ—¶å€™å°±åˆè¦åˆ†ä¸¤ç§æƒ…å†µæ¥çœ‹ã€‚**

#### ç¬¬ä¸€ç§æƒ…å†µï¼Œp[j-2] != s[i-1].

æ¯”å¦‚ `s = "abc", p = "abcd*"`ã€‚

æˆ‘ä»¬éå†åˆ° i - 1 = 2,å³ s[2] = `'c'`; j - 1 = 4, å³ p[4] = `'*'` æ—¶ï¼Œè¿™æ—¶æˆ‘ä»¬çœ‹ j-2 = 3 å¯¹åº”çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ p[3] = `'d'`å’Œå½“å‰çš„ s[2] ä¹Ÿä¸åŒ¹é…ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `'*'`å°† j - 2å¯¹åº”çš„ `'d'`æ¶ˆé™¤ï¼Œæˆ‘ä»¬ä¹Ÿåªæœ‰è¿™ä¸€ä¸ªé€‰æ‹©ï¼Œè™½ç„¶æ¶ˆé™¤åä¹Ÿä¸ä¸€å®šåŒ¹é…ï¼Œä½†æ˜¯ä¸æ¶ˆé™¤ä¸€å®šä¸åŒ¹é…ã€‚

é‚£ä¹ˆè¿™æ—¶å€™ï¼Œé—®é¢˜å°±å˜æˆäº†`s = "abc" å’Œ p = "abc"` åŒ¹é…çš„é—®é¢˜ã€‚è¿™å°±æ˜¯ä¸ªå­é—®é¢˜äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæƒ…å†µä¸‹çŠ¶æ€è½¬ç§»æ–¹ç¨‹å°±æ˜¯:

dp\[i][j] = dp\[i][j-2];

#### ç¬¬äºŒç§æƒ…å†µï¼Œp[j-2] = s[i-1]ã€‚

è¿™æ—¶å€™è¿˜å¯ä»¥åˆ†æˆä¸‰ç§æƒ…å†µã€‚

1. s = 'abc', p = "abcc\*";
   æˆ‘ä»¬ç”¨ `'*'`å°†æœ€åä¸€ä¸ª `'c'` æ¶ˆé™¤æ‰ï¼Œæˆ–è€…è¯´è®© `'*'` åŒ¹é… 0 ä¸ª 'c', ç„¶åæˆ‘ä»¬å¯ä»¥å¾—åˆ° `p = "abc"`ï¼›
   é‚£ä¹ˆå¯¹åº”çš„æ–¹ç¨‹å°±æ˜¯ dp\[i][j] = dp\[i][j-2];

2. s = "abc", p = "abc*";
   æˆ‘ä»¬å°† `'*'` æœ¬èº«æ¶ˆé™¤æ‰ï¼Œæˆ–è€…è¯´ç”¨ `'*'` åŒ¹é…ä¸€ä¸ª `'c'`ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥å¾—åˆ° `p = "abc"`ï¼›
   é‚£ä¹ˆå¯¹åº”çš„æ–¹ç¨‹å°±æ˜¯ dp\[i][j] = dp\[i][j-1];

3. s = "abcc" or "abccc" or "abcccc..", p = "abc*"
   æˆ‘ä»¬å¯ä»¥ç”¨ `'*'` åŒ¹é…å¤šä¸ª `'c'`ï¼Œé‚£æ€ä¹ˆä¸ªåŒ¹é…æ³•å‘¢ï¼Ÿ

   è¿™æ—¶åƒä¸‡ä¸èƒ½å¿˜è®°è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€è§„åˆ’çš„æ–¹ç¨‹ï¼Œå­é—®é¢˜åœ¨å‰é¢çš„çŠ¶æ€ä¸­å·²ç»è§£å†³è¿‡äº†ã€‚æ‰€ä»¥ä¸ç®¡sçš„æœ€åæœ‰å¤šå°‘ä¸ªcï¼Œæˆ‘ä»¬åªéœ€è¦æ¶ˆé™¤æœ€åä¸€ä¸ªcå°±å¯ä»¥äº†ã€‚s = `"abccc"` å°±å˜æˆäº† s = `"abcc"`.

   æˆ–è€…æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼Œs å˜æˆ `"abcc"`æ—¶ï¼Œp è¿˜æ˜¯ `"abc*"`ï¼Œæœ€åè¿™ä¸ª `'*'` è¿˜æ˜¯å¯ä»¥å’Œ s åŒ¹é…ï¼Œæœ€ç»ˆå°±å¯ä»¥æ¨åˆ°ä¹‹å‰çš„é—®é¢˜ï¼Œs = `"abc"`, p = `"abc"` ä¸Šã€‚

   æœ€åå¯¹åº”çš„æ–¹ç¨‹å°±æ˜¯ dp\[i][j] = dp\[i-1][j]

ç”±æ­¤å¯ä»¥å†™å‡ºä»£ç ï¼š

```java
public boolean isMatch(String s, String p) {
        int len1 = s.length();
        int len2 = p.length();

        boolean[][] dp = new boolean[len1 + 1][len2 + 1];

        dp[0][0] = true;

        for (int i = 2; i <= len2; i++) {
            dp[0][i] = p.charAt(i - 1) == '*' && dp[0][i - 2];
        }

        for (int i = 1; i <= len1; i++) {
            for (int j = 1; j <= len2; j++) {
                if (p.charAt(j - 1) == '.' || p.charAt(j - 1) == s.charAt(i - 1)) {
                    dp[i][j] = dp[i - 1][j - 1];
                } else if (p.charAt(j - 1) == '*') {
                    if (j > 1 && s.charAt(i - 1) != p.charAt(j - 2) && p.charAt(j - 2) != '.') {
                        dp[i][j] = dp[i][j - 2];
                    } else {
                        dp[i][j] = dp[i - 1][j] || dp[i][j - 1] || dp[i][j - 2];
                    }
                }
            }
        }
        return dp[len1][len2];
    }

```

![image-20240816095427551](image/image-20240816095427551.png)

### NFA

éç¡®å®šæ€§æœ‰é™è‡ªåŠ¨æœºï¼Œå…è®¸ä»å½“å‰çŠ¶æ€é€šè¿‡ç»™å®šè¾“å…¥è½¬ç§»åˆ°å¤šä¸ªå¯èƒ½çš„çŠ¶æ€ï¼Œæˆ–è€…æ²¡æœ‰è½¬ç§»ã€‚NFA å¯ä»¥ä½¿ç”¨é›†åˆæ¥è¡¨ç¤ºæ¯ä¸ªçŠ¶æ€çš„å¯èƒ½è½¬ç§»

åœ¨ä½¿ç”¨è‡ªåŠ¨æœºæ—¶ï¼Œå°†åŒ¹é…ä¸²`s`è¾“å…¥åˆ°è‡ªåŠ¨æœºä¸­ï¼Œåˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾ç»ˆæ­¢çŠ¶æ€ã€‚

å‚è€ƒï¼šhttps://leetcode.cn/problems/regular-expression-matching/solutions/30629/liang-chong-jie-fa-by-jason-2-20/

```java
class Solution {
    public boolean isMatch(String s, String p) {
        // Sä¸²å½“å‰ä¸‹æ ‡ä½ç½®ï¼Œåˆšå¼€å§‹ä¸º0
        int index = 0;
        // ä¸‹ä¸€ä¸ªçŠ¶æ€é›†åˆ
        // è¿™é‡ŒçŠ¶æ€ç”¨pä¸²çš„ä¸‹æ ‡è¡¨ç¤ºï¼Œä»£è¡¨ä¸‹ä¸€æ¬¡å¯ä»¥ä»pçš„è¿™äº›ä¸‹æ ‡å¼€å§‹åŒ¹é…
        Set<Integer> nextState = new HashSet<>();
        // ç”±äºæ˜¯åˆšå¼€å§‹åŒ¹é…ï¼Œè¿™æ—¶å€™pä¸‹ä¸€ä¸ªä¸‹æ ‡æ˜¯0
        nextMatch(p, 0, nextState);
        // nextStateä¸ä¸ºç©ºæ—¶ï¼Œè¡¨ç¤ºè¿˜æœ‰åˆæ³•çš„ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼ŒåŒ¹é…ç»§ç»­
        while (!nextState.isEmpty()){
            // å½“å‰çŠ¶æ€å°±æ˜¯ä¸Šä¸€æ¬¡çš„nextState
            Set<Integer> nowState = nextState;
            // åˆ›å»ºæ–°çš„nextState
            nextState = new HashSet<>();
            // æµ‹è¯•s[index]å’Œé›†åˆé‡Œçš„çŠ¶æ€æ˜¯å¦æœ‰åŒ¹é…
            for (int state : nowState){
                // å¦‚æœåŒæ—¶åˆ°è¾¾så’Œpä¸²æœ«å°¾ï¼ŒåŒ¹é…æˆåŠŸ
                if (state >= p.length() && index >= s.length()){
                    return true;
                }
                // ä»…ä»…påˆ°è¾¾æœ«å°¾è¿˜ä¸è¡Œ
                else if (state >= p.length()){
                    continue;
                }
                // så’Œpéƒ½æœªåˆ°è¾¾æœ«å°¾
                else if (index < s.length()){
                    // è¿™é‡Œæ˜¯åŒ¹é…ä¸Šçš„æƒ…å†µ
                    if (p.charAt(state) == '.' || s.charAt(index) == p.charAt(state)){
                        // å¦‚æœpä¸²çš„ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯'*'ï¼Œå½“å‰çŠ¶æ€å¯ä»¥åŒ¹é…ä»»æ„å¤šæ¬¡ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªçŠ¶æ€è¿˜æ˜¯å½“å‰
                        if (state+1 < p.length() && p.charAt(state+1) == '*'){
                            nextMatch(p, state, nextState);
                        }
                        // å¦åˆ™ï¼Œä¸‹ä¸€ä¸ªçŠ¶æ€å°±æ˜¯state+1
                        else {
                            nextMatch(p, state+1, nextState);
                        }
                    }
                }
            }
            index++;
        }
        // æ­¤æ—¶ï¼ŒnextStateä¸ºç©ºï¼Œä»£è¡¨æ²¡æœ‰åˆæ³•çš„ä¸‹ä¸€ä¸ªçŠ¶æ€äº†ï¼ŒåŒ¹é…å¤±è´¥
        return false;
    }

    // p:æ­£åˆ™è¡¨è¾¾å¼
    // state:ä¸‹ä¸€ä¸ªçŠ¶æ€
    // nextState:ä¸‹ä¸€ä¸ªçŠ¶æ€é›†åˆï¼Œæ— é‡å¤
    private void nextMatch(String p, int state, Set<Integer> nextState){
        // é¦–å…ˆåŠ ä¸Šä¸‹ä¸€ä¸ªçŠ¶æ€åˆ°çŠ¶æ€é›†ä¸­
        nextState.add(state);
        // è¿™é‡Œæ˜¯åˆ¤æ–­ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯'*'çš„æƒ…å†µï¼Œç”±äºæ­¤æ—¶åŒ¹é…æ¬¡æ•°å¯ä»¥æ˜¯0ï¼Œæ‰€ä»¥state+2ä¹Ÿæ˜¯åˆæ³•çš„ä¸‹ä¸€ä¸ªçŠ¶æ€
        if (state+1 < p.length() && p.charAt(state+1) == '*'){
            nextMatch(p, state+2, nextState);
        }
    }
}

```

![image-20240816105135655](image/image-20240816105135655.png)

```java
public class Solution {
    public boolean isMatch(String s, String p) {
        //æ„å»ºæœ‰ç©·è‡ªåŠ¨æœº
        NFA nfa = new NFA(p);
        return nfa.matches(s);
    }

    /**
     * ä¸ç¡®å®šçš„æœ‰é™è‡ªåŠ¨æœº
     */
    static class NFA {
        //æ­£åˆ™è¡¨è¾¾å¼
        private String re;
        //çŠ¶æ€ä¸ªæ•°å’Œæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦æ•°ç›¸åŒ
        private int statusNum;
        //æœ‰å‘å›¾
        private Digraph graph;

        public NFA(String re) {
            this.re = re;
            this.statusNum = re.length();
            //çŠ¶æ€å›¾çš„èŠ‚ç‚¹ç­‰äºçŠ¶æ€æ•°+1
            this.graph = new Digraph(statusNum + 1);
            //æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æ„å»ºå›¾
            this.compile();
        }

        private void compile() {
            for (int i = 0; i < statusNum; i++) {
                //å¯¹åº”å­—ç¬¦å’Œå­—ç¬¦ç´§è·Ÿ*çš„æƒ…å†µï¼Œæ„å»ºä¸¤æ¡è¾¹
                if (i < statusNum - 1 && this.re.charAt(i + 1) == '*') {
                    this.graph.addEdge(i, i + 1);
                    this.graph.addEdge(i + 1, i);
                }
                //
                if (this.re.charAt(i) == '*') {
                    this.graph.addEdge(i, i + 1);
                }
            }
        }

        /**
         * ç®—æ³•çš„æµç¨‹å¦‚ä¸‹ï¼š
         *
         * 1.è®¾å½“å‰çŠ¶æ€é›†åˆä¸º{0}ï¼›
         * 2.ä»€ä¹ˆå­—ç¬¦éƒ½ä¸è¯»ï¼Œæ ¹æ®pæ›´æ–°ä¸€ä¸‹å½“å‰çŠ¶æ€é›†åˆã€‚
         * 3.è¯»å–sçš„ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œæ ¹æ®pæ›´æ–°ä¸€ä¸‹å½“å‰çŠ¶æ€é›†åˆã€‚
         * å¦‚æœæ›´æ–°ä¹‹åå½“å‰çŠ¶æ€é›†åˆä¸ºç©ºé›†ï¼Œå³åŒ¹é…å¤±è´¥ï¼Œç›´æ¥è¿”å›False. å¦‚æœså·²ç»è¯»å®Œäº†ï¼Œæ‰§è¡Œç¬¬6æ­¥ã€‚
         * 4.ä»€ä¹ˆå­—ç¬¦éƒ½ä¸è¯»ï¼Œæ ¹æ®pæ›´æ–°ä¸€ä¸‹å½“å‰çŠ¶æ€é›†åˆã€‚
         * 5.å¾ªç¯ï¼Œå›åˆ°ç¬¬3æ­¥æ‰§è¡Œã€‚
         * 6.æ­¤æ—¶så·²ç»è¯»å®Œäº†ï¼Œå¦‚æœå½“å‰çŠ¶æ€é›†åˆé‡Œé¢æœ‰ç»ˆæ­¢çŠ¶æ€ï¼Œåˆ™è‡³å°‘æœ‰ä¸€ç§çŠ¶æ€è·³è½¬è·¯å¾„å¯ä»¥åŒ¹é…æˆåŠŸï¼Œè¿”å›Trueï¼Œå¦åˆ™è¿”å›False.
         * @param txt
         * @return
         */
        public boolean matches(String txt) {
            Set<Integer> pc = new HashSet<>();
            HashSet<Integer> source = new HashSet<Integer>() {{
                add(0);
            }};
            //ä»0å¼€å§‹åŒ¹é…
            DirectedDFS dfs = new DirectedDFS(graph, source);
            for (int v = 0; v < graph.v; v++) {
                if (dfs.visited[v]) {
                    pc.add(v);
                }
            }
            int len = txt.length();
            for (int i = 0; i < len; i++) {
                Set<Integer> match = new HashSet<>();
                for (Integer v : pc) {
                    if (v < this.statusNum) {
                        if (this.re.charAt(v) == txt.charAt(i) || this.re.charAt(v) == '.') {
                            match.add(v + 1);
                        }
                    }
                }
                pc = new HashSet<>();
                dfs = new DirectedDFS(graph, match);
                for (int v = 0; v < graph.v; v++) {
                    if (dfs.visited[v]) {
                        pc.add(v);
                    }
                }
            }
            //å¦‚æœå½“å‰çŠ¶æ€é›†åˆé‡Œé¢æœ‰ç»ˆæ­¢çŠ¶æ€ï¼Œåˆ™è‡³å°‘æœ‰ä¸€ç§çŠ¶æ€è·³è½¬è·¯å¾„å¯ä»¥åŒ¹é…æˆåŠŸ
            return pc.contains(this.statusNum);
        }


    }

    /**
     * æœ‰å‘å›¾
     */
    static class Digraph {
        //é¡¶ç‚¹å’Œè¾¹
        private int v;
        private int e;
        //ä¸´æ¥è¡¨
        private List<List<Integer>> adj;

        public Digraph(int v) {
            this.v = v;
            this.e = 0;
            this.adj = new ArrayList<>();
            for (int i = 0; i < v; i++) {
                this.adj.add(new ArrayList<>());
            }
        }

        private void addEdge(int v, int w) {
            this.adj.get(v).add(w);
            this.e++;
        }
    }

    /**
     * æœ‰å‘å›¾çš„æ·±åº¦ä¼˜å…ˆéå†
     */
    static class DirectedDFS {
        private Digraph graph;
        //åˆå§‹çŠ¶æ€é›†
        private Set<Integer> source;
        private boolean[] visited;

        /**
         * ä»åˆå§‹çŠ¶æ€é›†å¼€å§‹å¯¹å›¾è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ï¼ŒæŠŠèƒ½è®¿é—®åˆ°çš„ç‚¹è¿›è¡Œæ ‡è®°
         * @param graph
         * @param source
         */
        public DirectedDFS(Digraph graph, Set<Integer> source) {
            this.graph = graph;
            this.source = source;
            this.visited = new boolean[graph.v];
            for (Integer s : source) {
                if (!visited[s]) {
                    this.dfs(graph, s);
                }
            }
        }

        /**
         * å›¾çš„æ·±åº¦ä¼˜å…ˆéå†
         *
         * @param graph
         * @param v
         */
        private void dfs(Digraph graph, Integer v) {
            this.visited[v] = true;
            for (Integer w : graph.adj.get(v)) {
                if (!visited[w]) {
                    this.dfs(graph, w);
                }
            }
        }


    }
}
```

![image-20240816110706092](image/image-20240816110706092.png)